{"version":3,"names":["React","findNodeHandle","NativeModules","Platform","PanResponder","processColor","RNCSmartRefreshLayout","Commands","SmartRefreshControlCommands","DefaultHeader","SPModule","OS","SpinnerStyleModule","SmartRefreshControl","Component","constructor","args","_defineProperty","delayed","success","smartRefreshLayout","finishRefresh","renderHeader","HeaderComponent","props","createElement","e","onRefresh","event","shiftPercent","nativeEvent","percent","onHeaderPulling","onHeaderMoving","onHeaderReleasing","footerShiftPercent","componentWillMount","_panResponder","create","onMoveShouldSetPanResponderCapture","evt","gestureState","render","_this$props$children","_this$_panResponder","primaryColor","nativeProps","onSmartRefresh","_onSmartRefresh","_onHeaderPulling","_onHeaderReleasing","onFooterMoving","_onFooterMoving","children","bounces","_extends","ref","panHandlers","TRANSLATE","translate","SCALE","scale","FIX_BEHIND","fixBehind","FIX_FRONT","fixFront","MATCH_LAYOUT","matchLayout"],"sources":["SmartRefreshControl.tsx"],"sourcesContent":["import React, { Component } from \"react\";\r\nimport {\r\n  StyleSheet,\r\n  View,\r\n  Image,\r\n  Text,\r\n  requireNativeComponent,\r\n  findNodeHandle,\r\n  UIManager,\r\n  NativeModules,\r\n  Platform,\r\n  PanResponder,\r\n  processColor,\r\n} from \"react-native\";\r\nimport type * as ReactNative from \"react-native\";\r\nimport RNCSmartRefreshLayout, {\r\n  NativeProps as Props,\r\n  Commands as SmartRefreshControlCommands,\r\n  OnHeaderEventData,\r\n  VoidEventData,\r\n} from \"./fabric/SmartRefreshControlNativeComponent\";\r\nimport type { DirectEventHandler } from \"react-native/Libraries/Types/CodegenTypes\";\r\nimport { PanResponderInstance } from \"react-native/Libraries/Interaction/PanResponder\";\r\nimport { ColorValue } from \"react-native/Libraries/StyleSheet/StyleSheet\";\r\nimport DefaultHeader from \"./fabric/DefaultHeaderNativeComponent\";\r\nimport AnyHeader from \"./AnyHeader\";\r\n\r\nconst SPModule =\r\n  Platform.OS === \"android\" ? NativeModules.SpinnerStyleModule : {};\r\n\r\ntype SmartRefreshControlProps = Props & {\r\n  HeaderComponent?: React.ReactNode;\r\n  renderHeader?: () => React.ReactElement | React.ReactElement;\r\n  onHeaderMoving?: DirectEventHandler<OnHeaderEventData>;\r\n};\r\n\r\nexport class SmartRefreshControl extends React.Component<SmartRefreshControlProps> {\r\n  private _panResponder: PanResponderInstance | null = null;\r\n  smartRefreshLayout: React.ElementRef<typeof RNCSmartRefreshLayout> | null =\r\n    null;\r\n\r\n  static constants = {\r\n    TRANSLATE: SPModule.translate,\r\n    SCALE: SPModule.scale,\r\n    FIX_BEHIND: SPModule.fixBehind,\r\n    FIX_FRONT: SPModule.fixFront,\r\n    MATCH_LAYOUT: SPModule.matchLayout,\r\n  };\r\n\r\n  /**\r\n   * 参数格式为{delayed:number,success:bool}\r\n   * delayed:延迟刷新\r\n   * success:是否刷新成功\r\n   * @param params\r\n   */\r\n  finishRefresh = (\r\n    { delayed = -1, success = true } = { delayed: -1, success: true },\r\n  ) => {\r\n    // this.dispatchCommand('finishRefresh',[delayed,success])\r\n    if (this.smartRefreshLayout) {\r\n      SmartRefreshControlCommands.finishRefresh(\r\n        this.smartRefreshLayout,\r\n        delayed,\r\n        success,\r\n      );\r\n    }\r\n  };\r\n  findNode = () => {\r\n    return findNodeHandle(this.smartRefreshLayout);\r\n  };\r\n  componentWillMount() {\r\n    this._panResponder = PanResponder.create({\r\n      onMoveShouldSetPanResponderCapture: (evt, gestureState) => {\r\n        if (this.shiftPercent >= 0.039 || this.footerShiftPercent >= 0.068) {\r\n          //满足条件捕获事件\r\n          return true;\r\n        }\r\n        return false;\r\n      },\r\n    });\r\n  }\r\n\r\n  shiftPercent = 0; //header位移百分比，默认为0\r\n\r\n  footerShiftPercent = 0; // footer位移百分比\r\n  /**\r\n   * 渲染Header\r\n   * @return {*}\r\n   */\r\n  renderHeader = () => {\r\n    const { renderHeader, HeaderComponent } = this.props;\r\n    if (renderHeader) {\r\n      return renderHeader();\r\n    }\r\n    if (HeaderComponent) {\r\n      return HeaderComponent;\r\n    }\r\n    return <DefaultHeader />;\r\n  };\r\n  /**\r\n   * 刷新时触发\r\n   * @private\r\n   */\r\n  private _onSmartRefresh = (\r\n    e: ReactNative.NativeSyntheticEvent<VoidEventData>,\r\n  ) => {\r\n    let { onRefresh } = this.props;\r\n    onRefresh && onRefresh(e);\r\n  };\r\n  /**\r\n   * 下拉过程\r\n   * @param event\r\n   * @private\r\n   */\r\n  _onHeaderPulling = (\r\n    event: ReactNative.NativeSyntheticEvent<OnHeaderEventData>,\r\n  ) => {\r\n    this.shiftPercent = event.nativeEvent.percent;\r\n    let { onHeaderPulling, onHeaderMoving } = this.props;\r\n    onHeaderMoving && onHeaderMoving(event);\r\n    onHeaderPulling && onHeaderPulling(event);\r\n  };\r\n  /**\r\n   * 释放过程\r\n   * @param event\r\n   * @private\r\n   */\r\n  _onHeaderReleasing = (\r\n    event: ReactNative.NativeSyntheticEvent<OnHeaderEventData>,\r\n  ) => {\r\n    this.shiftPercent = event.nativeEvent.percent;\r\n    let { onHeaderReleasing, onHeaderMoving } = this.props;\r\n    onHeaderMoving && onHeaderMoving(event);\r\n    onHeaderReleasing && onHeaderReleasing(event);\r\n  };\r\n  /**\r\n   * 底部位移过程\r\n   * @param event\r\n   * @private\r\n   */\r\n  _onFooterMoving = (\r\n    event: ReactNative.NativeSyntheticEvent<OnHeaderEventData>,\r\n  ) => {\r\n    this.footerShiftPercent = event.nativeEvent.percent;\r\n  };\r\n\r\n  render() {\r\n    const primaryColor = processColor(this.props.primaryColor);\r\n    const nativeProps = {\r\n      ...this.props,\r\n      ...{\r\n        onSmartRefresh: this._onSmartRefresh,\r\n        onHeaderPulling: this._onHeaderPulling,\r\n        onHeaderReleasing: this._onHeaderReleasing,\r\n        onFooterMoving: this._onFooterMoving,\r\n      },\r\n    };\r\n    if (primaryColor) {\r\n      nativeProps.primaryColor = primaryColor;\r\n    }\r\n\r\n    // @ts-ignore\r\n    if (typeof this.props.children?.props === \"object\" && Platform.OS === 'harmony') {\r\n      // @ts-ignore\r\n      this.props.children.props.bounces = false;\r\n    }\r\n    return (\r\n      <RNCSmartRefreshLayout\r\n        ref={(ref) => {\r\n          this.smartRefreshLayout = ref;\r\n        }}\r\n        {...nativeProps}\r\n        {...this._panResponder?.panHandlers}\r\n      >\r\n        {this.props.children}\r\n        {this.renderHeader()}\r\n      </RNCSmartRefreshLayout>\r\n    );\r\n  }\r\n}\r\n\r\nexport default SmartRefreshControl;\r\n"],"mappings":"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"}