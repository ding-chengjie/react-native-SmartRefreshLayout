{"version":3,"names":["_react","_interopRequireDefault","require","_reactNative","_SmartRefreshControlNativeComponent","_interopRequireWildcard","_DefaultHeaderNativeComponent","_getRequireWildcardCache","e","WeakMap","r","t","__esModule","default","has","get","n","__proto__","a","Object","defineProperty","getOwnPropertyDescriptor","u","prototype","hasOwnProperty","call","i","set","obj","_extends","assign","bind","target","arguments","length","source","key","apply","_defineProperty","value","_toPropertyKey","enumerable","configurable","writable","_toPrimitive","String","Symbol","toPrimitive","TypeError","Number","SPModule","Platform","OS","NativeModules","SpinnerStyleModule","SmartRefreshControl","React","Component","constructor","args","delayed","success","smartRefreshLayout","SmartRefreshControlCommands","finishRefresh","findNodeHandle","renderHeader","HeaderComponent","props","createElement","onRefresh","event","shiftPercent","nativeEvent","percent","onHeaderPulling","onHeaderMoving","onHeaderReleasing","footerShiftPercent","componentWillMount","_panResponder","PanResponder","create","onMoveShouldSetPanResponderCapture","evt","gestureState","render","_this$props$children","_this$_panResponder","primaryColor","processColor","nativeProps","onSmartRefresh","_onSmartRefresh","_onHeaderPulling","_onHeaderReleasing","onFooterMoving","_onFooterMoving","children","bounces","ref","panHandlers","exports","TRANSLATE","translate","SCALE","scale","FIX_BEHIND","fixBehind","FIX_FRONT","fixFront","MATCH_LAYOUT","matchLayout","_default"],"sources":["SmartRefreshControl.tsx"],"sourcesContent":["import React, { Component } from \"react\";\r\nimport {\r\n  StyleSheet,\r\n  View,\r\n  Image,\r\n  Text,\r\n  requireNativeComponent,\r\n  findNodeHandle,\r\n  UIManager,\r\n  NativeModules,\r\n  Platform,\r\n  PanResponder,\r\n  processColor,\r\n} from \"react-native\";\r\nimport type * as ReactNative from \"react-native\";\r\nimport RNCSmartRefreshLayout, {\r\n  NativeProps as Props,\r\n  Commands as SmartRefreshControlCommands,\r\n  OnHeaderEventData,\r\n  VoidEventData,\r\n} from \"./fabric/SmartRefreshControlNativeComponent\";\r\nimport type { DirectEventHandler } from \"react-native/Libraries/Types/CodegenTypes\";\r\nimport { PanResponderInstance } from \"react-native/Libraries/Interaction/PanResponder\";\r\nimport { ColorValue } from \"react-native/Libraries/StyleSheet/StyleSheet\";\r\nimport DefaultHeader from \"./fabric/DefaultHeaderNativeComponent\";\r\nimport AnyHeader from \"./AnyHeader\";\r\n\r\nconst SPModule =\r\n  Platform.OS === \"android\" ? NativeModules.SpinnerStyleModule : {};\r\n\r\ntype SmartRefreshControlProps = Props & {\r\n  HeaderComponent?: React.ReactNode;\r\n  renderHeader?: () => React.ReactElement | React.ReactElement;\r\n  onHeaderMoving?: DirectEventHandler<OnHeaderEventData>;\r\n};\r\n\r\nexport class SmartRefreshControl extends React.Component<SmartRefreshControlProps> {\r\n  private _panResponder: PanResponderInstance | null = null;\r\n  smartRefreshLayout: React.ElementRef<typeof RNCSmartRefreshLayout> | null =\r\n    null;\r\n\r\n  static constants = {\r\n    TRANSLATE: SPModule.translate,\r\n    SCALE: SPModule.scale,\r\n    FIX_BEHIND: SPModule.fixBehind,\r\n    FIX_FRONT: SPModule.fixFront,\r\n    MATCH_LAYOUT: SPModule.matchLayout,\r\n  };\r\n\r\n  /**\r\n   * 参数格式为{delayed:number,success:bool}\r\n   * delayed:延迟刷新\r\n   * success:是否刷新成功\r\n   * @param params\r\n   */\r\n  finishRefresh = (\r\n    { delayed = -1, success = true } = { delayed: -1, success: true },\r\n  ) => {\r\n    // this.dispatchCommand('finishRefresh',[delayed,success])\r\n    if (this.smartRefreshLayout) {\r\n      SmartRefreshControlCommands.finishRefresh(\r\n        this.smartRefreshLayout,\r\n        delayed,\r\n        success,\r\n      );\r\n    }\r\n  };\r\n  findNode = () => {\r\n    return findNodeHandle(this.smartRefreshLayout);\r\n  };\r\n  componentWillMount() {\r\n    this._panResponder = PanResponder.create({\r\n      onMoveShouldSetPanResponderCapture: (evt, gestureState) => {\r\n        if (this.shiftPercent >= 0.039 || this.footerShiftPercent >= 0.068) {\r\n          //满足条件捕获事件\r\n          return true;\r\n        }\r\n        return false;\r\n      },\r\n    });\r\n  }\r\n\r\n  shiftPercent = 0; //header位移百分比，默认为0\r\n\r\n  footerShiftPercent = 0; // footer位移百分比\r\n  /**\r\n   * 渲染Header\r\n   * @return {*}\r\n   */\r\n  renderHeader = () => {\r\n    const { renderHeader, HeaderComponent } = this.props;\r\n    if (renderHeader) {\r\n      return renderHeader();\r\n    }\r\n    if (HeaderComponent) {\r\n      return HeaderComponent;\r\n    }\r\n    return <DefaultHeader />;\r\n  };\r\n  /**\r\n   * 刷新时触发\r\n   * @private\r\n   */\r\n  private _onSmartRefresh = (\r\n    e: ReactNative.NativeSyntheticEvent<VoidEventData>,\r\n  ) => {\r\n    let { onRefresh } = this.props;\r\n    onRefresh && onRefresh(e);\r\n  };\r\n  /**\r\n   * 下拉过程\r\n   * @param event\r\n   * @private\r\n   */\r\n  _onHeaderPulling = (\r\n    event: ReactNative.NativeSyntheticEvent<OnHeaderEventData>,\r\n  ) => {\r\n    this.shiftPercent = event.nativeEvent.percent;\r\n    let { onHeaderPulling, onHeaderMoving } = this.props;\r\n    onHeaderMoving && onHeaderMoving(event);\r\n    onHeaderPulling && onHeaderPulling(event);\r\n  };\r\n  /**\r\n   * 释放过程\r\n   * @param event\r\n   * @private\r\n   */\r\n  _onHeaderReleasing = (\r\n    event: ReactNative.NativeSyntheticEvent<OnHeaderEventData>,\r\n  ) => {\r\n    this.shiftPercent = event.nativeEvent.percent;\r\n    let { onHeaderReleasing, onHeaderMoving } = this.props;\r\n    onHeaderMoving && onHeaderMoving(event);\r\n    onHeaderReleasing && onHeaderReleasing(event);\r\n  };\r\n  /**\r\n   * 底部位移过程\r\n   * @param event\r\n   * @private\r\n   */\r\n  _onFooterMoving = (\r\n    event: ReactNative.NativeSyntheticEvent<OnHeaderEventData>,\r\n  ) => {\r\n    this.footerShiftPercent = event.nativeEvent.percent;\r\n  };\r\n\r\n  render() {\r\n    const primaryColor = processColor(this.props.primaryColor);\r\n    const nativeProps = {\r\n      ...this.props,\r\n      ...{\r\n        onSmartRefresh: this._onSmartRefresh,\r\n        onHeaderPulling: this._onHeaderPulling,\r\n        onHeaderReleasing: this._onHeaderReleasing,\r\n        onFooterMoving: this._onFooterMoving,\r\n      },\r\n    };\r\n    if (primaryColor) {\r\n      nativeProps.primaryColor = primaryColor;\r\n    }\r\n\r\n    // @ts-ignore\r\n    if (typeof this.props.children?.props === \"object\" && Platform.OS === 'harmony') {\r\n      // @ts-ignore\r\n      this.props.children.props.bounces = false;\r\n    }\r\n    return (\r\n      <RNCSmartRefreshLayout\r\n        ref={(ref) => {\r\n          this.smartRefreshLayout = ref;\r\n        }}\r\n        {...nativeProps}\r\n        {...this._panResponder?.panHandlers}\r\n      >\r\n        {this.props.children}\r\n        {this.renderHeader()}\r\n      </RNCSmartRefreshLayout>\r\n    );\r\n  }\r\n}\r\n\r\nexport default SmartRefreshControl;\r\n"],"mappings":"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"}